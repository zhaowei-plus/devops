var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,r=Object.getOwnPropertySymbols,a=Object.prototype.propertyIsEnumerable,n=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,l=(e,l)=>{for(var i in l||(l={}))t.call(l,i)&&n(e,i,l[i]);if(r)for(var i of r(l))a.call(l,i)&&n(e,i,l[i]);return e};import{_ as i,ae as o,l as s,ak as p,h as d,at as c,b as m,ag as u,k as y}from"./vendor.931d8f24.js";import{r as h}from"./index.d0ed3dc5.js";import{L as x}from"./index.54d80d25.js";import{u as f}from"./useList.da577dd6.js";import{u as b}from"./useVisible.7f795f63.js";import{m as v,a as g}from"./index.6547ff7d.js";const E=[{label:"讯盟内部应用",value:1},{label:"外部应用",value:2}];const O=e=>{const{params:t={},onCancel:r,onOk:a}=e,{title:n,type:o,record:u}=t,y=i.useMemo((()=>s.createAsyncFormActions()),[]),x=e=>{let t={};return e&&e instanceof Array&&e.map((e=>{t[e.name]=e.value})),t},f=e=>Object.keys(e).map((t=>({name:t,value:e[t]}))),b=i.useMemo((()=>{if(u){const e=f(JSON.parse(u.param)),t=f(JSON.parse(u.header));return l(l({},u),{param:e,header:t})}return{}}),[u]),v={app:{required:!0,type:"string",title:"app"},url:{required:!0,type:"string",title:"url"},path:{required:!0,type:"string",title:"path"},method:{required:!0,type:"string",title:"请求方式",enum:["GET","POST"]},header:{type:"textarea",title:"请求header",maxItems:3,"x-component":"ArrayTable","x-component-props":{renderMoveDown:()=>null,renderMoveUp:()=>null},items:{type:"object",properties:{name:{type:"string",title:"名称","x-props":{style:{minWidth:"140px"}}},value:{type:"string",title:"参数值","x-props":{style:{minWidth:"140px"}}}}}},param:{type:"array",title:"请求参数",maxItems:3,"x-component":"ArrayTable","x-component-props":{renderMoveDown:()=>null,renderMoveUp:()=>null},items:{type:"object",properties:{name:{type:"string",title:"名称","x-props":{style:{minWidth:"140px"}}},value:{type:"string",title:"参数值","x-props":{style:{minWidth:"140px"}}}}}},type:{required:!0,type:"string",title:"type",enum:E}};return i.createElement(p,{visible:!0,centered:!0,title:n,onOk:()=>y.submit(),onCancel:r,className:"health-check_add-modal"},i.createElement(d,{labelCol:5,wrapperCol:18,actions:y,onSubmit:e=>{const t=JSON.stringify(x(e.param)),r=JSON.stringify(x(e.header));return h.post("/dev-ops/interface/editCheck",l(l({},e),{param:t,header:r})).then((e=>{m.success(`${n}成功`),a()}))},components:{ArrayTable:c},previewPlaceholder:"暂无数据",editable:"detail"!==o,initialValues:b,schema:{type:"object",properties:g(v)}}))},{Header:j,Content:k}=x;export default()=>{const e=b(),t=f("/dev-ops/interface/checkList");i.useEffect((()=>{t.onSearch()}),[]);const r=(e=>{const{handleEdit:t,handleDelete:r}=e;return[{title:"ID",dataIndex:"id"},{title:"应用名",dataIndex:"app"},{title:"请求地址",dataIndex:"url"},{title:"路径",dataIndex:"path"},{title:"请求方式",dataIndex:"method"},{title:"请求header",dataIndex:"header"},{title:"请求参数",dataIndex:"param"},{title:"请求应用来源",dataIndex:"type",render:e=>v(e,E)},{title:"操作",dataIndex:"id",render:(e,a)=>i.createElement(o,null,i.createElement("a",{onClick:()=>t(a)},"编辑"),i.createElement("a",{onClick:()=>r(a)},"删除"))}]})({handleEdit:t=>{e.open({type:"edit",title:"编辑监控接口",record:t})},handleDelete:({id:e})=>{p.confirm({centered:!0,title:"提示",content:"确定删除吗？",onOk:()=>h.post("/dev-ops/interface/deleteCheck",{id:e}).then((()=>{m.success("删除成功"),t.onRefresh()}))})}});return i.createElement(x,{loading:t.loading},i.createElement(j,{title:"健康检查",extra:i.createElement(u,{type:"primary",onClick:()=>{e.open({type:"add",title:"新增监控接口"})}},"新增监控接口")}),i.createElement(k,null,i.createElement(y,l(l({columns:r},t.table),{scroll:{x:"max-content"}}))),e.visible&&i.createElement(O,{params:e.params,onCancel:e.close,onOk:()=>{e.close(t.onRefresh())}}))};
