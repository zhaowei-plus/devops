var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,n=Object.prototype.propertyIsEnumerable,l=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,r=(e,r)=>{for(var i in r||(r={}))t.call(r,i)&&l(e,i,r[i]);if(a)for(var i of a(r))n.call(r,i)&&l(e,i,r[i]);return e};import{_ as i,ae as s,aw as o,l as c,ag as m,ax as p,ay as d,az as u,aA as g,aB as f,ak as h,h as y,b,k as x}from"./vendor.931d8f24.js";import{L as E}from"./index.54d80d25.js";import{S as v}from"./index.cd79d446.js";import{r as C}from"./index.d0ed3dc5.js";import{u as P}from"./useList.da577dd6.js";import{u as k}from"./useVisible.7f795f63.js";import{a as j}from"./index.6547ff7d.js";const w=[{label:"链路跟踪",value:"trace-id"},{label:"Url重写",value:"url-rewrite"},{label:"请求头重写",value:"request-header-override"},{label:"IP过滤",value:"ip-filter"},{label:"方法重写",value:"override-method"},{label:"内容大小限制",value:"content-limit"},{label:"超时时间",value:"request-timeout"},{label:"限流",value:"rate-limit"},{label:"访问日志",value:"access-log"},{label:"MOCK",value:"mock"}],O=o((e=>i.createElement("div",r({},e))))`
  >.ant-form-item {
    display: inline-flex;
    margin-right: 10px;
    margin-bottom: 16px;
    width:40%;
  }
`,I=e=>{const{initialValue:t}=e;return i.createElement(c.InternalFieldList,{name:"userList",initialValue:t},(({state:e,mutators:t})=>{const a=()=>t.push();return e.value&&0===e.value.length?i.createElement(i.Fragment,null,i.createElement("h1",null,"暂无数据"),i.createElement(m,{onClick:a},i.createElement(p,null))):i.createElement("div",null,i.createElement("p",{className:"ant-row"},i.createElement("label",{className:"ant-col-4 ant-form-item-label"},"plugin：")),e.value.map(((e,a)=>i.createElement(O,{key:a},i.createElement(d,{name:`userList.${a}.name`,component:u,dataSource:w}),i.createElement(d,{name:`userList.${a}.value`,component:g}),i.createElement(m,{onClick:()=>{return e=a,t.remove(e);var e}},i.createElement(f,null))))),i.createElement(m,{onClick:a},i.createElement(p,null)))}))};I.isFieldComponent=!0;var A=e=>{const{onOk:l,onCancel:s,params:o}=e,{title:m,record:p}=o,[d,u]=i.useState([]),g=i.useMemo((()=>c.createAsyncFormActions()),[]),f=i.useMemo((()=>{if(p){const e=Object.keys(p.settings.pluginConfigs).map((e=>({name:e,value:p.settings.pluginConfigs[e]})));return r(r({},p),{plugins:e})}return p}),[p]);i.useEffect((()=>{C.get("/dev-ops/devops/db/dbList").then((e=>{u(e)}))}),[]);const x={name:{type:"string",title:"name","x-props":{placeholder:"input location name"}},uriPattern:{type:"string",title:"UriPattern","x-props":{placeholder:"^~(Prefix), =(Exact), ~*(Regex)"}},proxyPass:{type:"string",title:"ProxyPass",description:"e.g:\nAACE         : aace://proxy.interface.${0}\nHttpDirect   : http://host:port/xxx/ (Take notice the last '/')\nHttpCenter   : http://xxx.center/xxx/ (Take notice the last '/')\nConfigCenter : cc://app/${0}\nRedis        : redis://redisKey/db/${0}\nMysql        : mysql://dbKey/table","x-props":{placeholder:"(aace|http(s))://[host][:port]/path/${[0-9]}[/]"}},plugins:{type:"array","x-component":"ArrayPlugin",items:{type:"object",properties:{name:{type:"string",enum:w},value:{type:"string"}}}}};return i.createElement(h,{visible:!0,centered:!0,wrapClassName:"route-config-add-modal",title:m,onOk:()=>g.submit().then((({values:e})=>{let i={};e.plugins&&Object.assign({},e.plugins.map((e=>{i[e.name]=e.value})));const{plugins:s}=e,o=((e,l)=>{var r={};for(var i in e)t.call(e,i)&&l.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&a)for(var i of a(e))l.indexOf(i)<0&&n.call(e,i)&&(r[i]=e[i]);return r})(e,["plugins"]);return C.post("/awg-admin/api/location/save",r(r({},o),{settings:{pluginConfigs:i}})).then((()=>{b.success("添加成功"),l()}))})),onCancel:s},i.createElement(y,{labelCol:4,validateFirst:!0,wrapperCol:20,actions:g,initialValues:f,components:{ArrayPlugin:I},schema:{type:"object",properties:j(x)}}))};const{Header:L,Content:R}=E;export default()=>{const e=k(),t=P("/awg-admin/api/location/search"),a=(e,a)=>{const n={1:"禁用",0:"启用"};return C.get("/awg-admin/api/location/changeStatus",{id:e,status:a}).then((e=>{b.success(`${n[a]}成功`),t.onRefresh()}))};i.useEffect((()=>{t.onRefresh()}),[]);const n={name:{type:"string",title:"name"},uriPattern:{type:"string",title:"UriPattern"},proxyPass:{type:"string",title:"ProxyPass"}},l=(e=>{const{handleEdit:t,handleCopy:a,handleEnable:n,handleDisabled:l,handleDelete:r}=e;return[{title:"编号",dataIndex:"id",render:(e,t,a)=>a+1},{title:"name",dataIndex:"name"},{title:"UriPattern",dataIndex:"uriPattern"},{title:"ProxyPass",dataIndex:"proxyPass"},{title:"操作",dataIndex:"disabled",render:(e,o)=>i.createElement(s,null,i.createElement("a",{onClick:()=>t(o)},"编辑"),i.createElement("a",{onClick:()=>a(o)},"复制"),e?i.createElement("a",{onClick:()=>n(o)},"启用"):i.createElement("a",{onClick:()=>l(o)},"禁用"),i.createElement("a",{onClick:()=>r(o)},"删除"))}]})({handleEdit:t=>{e.open({type:"edit",title:"编辑路由",record:t})},handleCopy:({id:e})=>C.post("/awg-admin/api/location/copy",{id:e}).then((e=>{b.success("拷贝成功"),t.onRefresh()})),handleEnable:({id:e})=>{a(e,0)},handleDisabled:({id:e})=>{a(e,1)},handleDelete:({id:e})=>{h.confirm({title:"删除后不可恢复，确定删除数据？",content:"",onOk:()=>{C.get("/awg-admin/api/location/delete",{id:e}).then((e=>{b.success("删除成功"),t.onRefresh()}))}})}});return i.createElement(E,null,i.createElement(L,{title:"路由配置",extra:i.createElement(m,{type:"primary",onClick:()=>{e.open({type:"add",title:"新增路由"})}},"新增路由")}),i.createElement(R,{wrapperClassName:"route-config"},i.createElement(v,{schema:n,onSearch:t.onSearch}),i.createElement(x,r({columns:l},t.table))),e.visible&&i.createElement(A,{params:e.params,onCancel:e.close,onOk:()=>{e.close(),t.onRefresh()}}))};
