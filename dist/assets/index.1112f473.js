var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.propertyIsEnumerable,n=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,o=(e,n)=>{var o={};for(var c in e)t.call(e,c)&&n.indexOf(c)<0&&(o[c]=e[c]);if(null!=e&&a)for(var c of a(e))n.indexOf(c)<0&&l.call(e,c)&&(o[c]=e[c]);return o};import{_ as c,aj as r,n as s,an as i,e as m,ao as p,ap as d,aq as g,a7 as u,I as v,ar as E}from"./vendor.931d8f24.js";import{C as h,L as f}from"./index.54d80d25.js";import{r as y}from"./index.d0ed3dc5.js";import{S as _}from"./index.cd79d446.js";import{_ as N}from"./index.f4c393b6.js";import{u as S}from"./useList.da577dd6.js";const b={key:{type:"string",title:"关键词"},type:{type:"string",title:"关联方式",enum:[{label:"且",value:1},{label:"或",value:2},{label:"非",value:3}],default:1},line:{type:"number",title:"查看行数","x-props":{step:1}},time:{type:"date",title:"时间","x-props":{showTime:!0,format:"YYYY-MM-DD HH:mm",placeholder:"查询某个时刻的日志"}},contextLine:{type:"number",title:"上下文行数","x-props":{step:1,min:0,max:99}}};var x=e=>{const{ip:t,catelog:a,path:l="/"}=e,[n,s]=c.useState(),[i,m]=c.useState({ip:t,catelog:a,path:`/${l}`,type:1,line:100,contextLine:0});return c.useEffect((()=>{var e;l&&(e=i,y.get("/dev-ops/devops/logfind/readLog",e).then((e=>{e.success&&s(e.data)})))}),[i]),c.createElement("div",{className:"log-info"},l&&c.createElement(c.Fragment,null,c.createElement("div",{className:"log-info__header"},c.createElement("label",{className:"title"},"日志文件路径：",l)),c.createElement("div",{className:"log-info__content"},c.createElement(_,{schema:b,params:i,onSearch:e=>{const{time:t}=e,a=o(e,["time"]);t&&(a.time=r(t).endOf("s").valueOf()),m(a)}}),c.createElement("div",{className:"info"},c.createElement(h,{value:n,language:"txt",editable:!1,options:{languages:["txt"]}})))))},w=e=>{const{ip:r,path:v="/",catelog:E,searchKey:h,onSelect:f}=e,[y,_]=c.useState(""),[b,x]=c.useState(),[w,C]=c.useState([]),j=S("/dev-ops/devops/logfind/list",{path:"",name:h},{ip:r,catelog:E,pageSize:20},!1);return c.useEffect((()=>{r&&(b?j.onSearch({catelog:E,name:h,path:`/${b}`}).then((e=>{C(e.dataSource)})):j.onSearch({catelog:E,name:h}).then((e=>{C(e.dataSource)})))}),[r,E,h,b]),c.createElement(s,{spinning:j.loading},c.createElement("div",{className:"categories"},b&&c.createElement("div",{className:"categories__header"},c.createElement(i,null,c.createElement(i.Item,{onClick:()=>{var e;x(e)}},c.createElement("a",null,"根目录")),c.createElement(i.Item,null,b))),c.createElement("div",{className:"categories__content list"},w.map(((e,t)=>c.createElement("div",{key:t,className:m("category",{active:e.name===y}),onClick:()=>(({type:e,name:t})=>{1===e&&(_(t),f(b?`${b}/${t}`:t))})(e)},0===e.type&&c.createElement("div",{className:"category__icon",onClick:t=>{t.stopPropagation(),(({name:e})=>{x(e)})(e)}},c.createElement(p,null)),1===e.type&&c.createElement("div",{className:"category__icon"},c.createElement(d,null)),c.createElement("div",{className:"category__info"},e.name),1===e.type&&c.createElement("div",{className:"category__operation",onClick:e=>{e.stopPropagation(),window.location.href=`/dev-ops/devops/logfind/downloadLog?${N({ip:r,path:v,catelog:E})}`}},c.createElement(g,null)))))),w.length>0&&c.createElement("div",{className:"categories__footer"},c.createElement("div",{className:"load-more",onClick:e=>{const c=j.table.pagination,{current:r}=c,s=o(c,["current"]);e.stopPropagation(),j.table.onChange(((e,o)=>{for(var c in o||(o={}))t.call(o,c)&&n(e,c,o[c]);if(a)for(var c of a(o))l.call(o,c)&&n(e,c,o[c]);return e})({current:r+1},s)).then((e=>{e.total>w.length&&C(w.concat(e.dataSource))}))}},c.createElement("span",null,"加载更多"),j.loading&&c.createElement(u,null)))))},C=e=>{const{ip:t,path:a,catelog:l,onSelect:n}=e,[o,r]=c.useState();return c.createElement("div",{className:"log-category"},c.createElement("div",{className:"log-category__header"},c.createElement(v.Search,{allowClear:!0,onSearch:e=>{r(e)},placeholder:"只支持当前目录下搜索"})),c.createElement("div",{className:"log-category__content"},c.createElement(w,{ip:t,path:a,catelog:l,onSelect:n,searchKey:o})))};const j=[{label:"日志",value:"log"},{label:"配置",value:"conf"},{label:"ace",value:"ace"},{label:"nginx",value:"nginx"}];const{Header:O,Content:k}=f;export default()=>{const[e,t]=c.useState(),[a,l]=c.useState(),[n,o]=c.useState([]),[r,s]=c.useState(j[0].value);return c.useEffect((()=>{y.get("/dev-ops/devops/monitor/dogs").then((e=>{o(e.data.map((e=>({label:e.name,value:e.ip}))))}))}),[]),c.createElement(f,null,c.createElement(O,{title:"远程查看"}),c.createElement(k,{wrapperClassName:"show-logs"},c.createElement("div",{className:"show-logs__header"},c.createElement("span",{className:"title"},"选择主机："),c.createElement("div",{className:"control"},c.createElement(E,{value:e,style:{width:220},options:n,placeholder:"请选择",onChange:e=>{t(e)}})),c.createElement("span",{className:"title"},"选择类型："),c.createElement("div",{className:"control"},c.createElement(E,{value:r,style:{width:220},options:j,placeholder:"请选择",onChange:e=>{s(e)}}))),c.createElement("div",{className:"show-logs__content"},c.createElement(C,{key:e,ip:e,path:a,catelog:r,onSelect:l}),c.createElement(x,{ip:e,key:a,path:a,catelog:r}))))};
