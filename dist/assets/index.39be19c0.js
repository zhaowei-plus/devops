var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,r=Object.prototype.propertyIsEnumerable,n=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,l=(e,l)=>{for(var i in l||(l={}))t.call(l,i)&&n(e,i,l[i]);if(a)for(var i of a(l))r.call(l,i)&&n(e,i,l[i]);return e};import{_ as i,ae as o,l as d,ak as c,ag as s,h as p,b as m,k as u,R as y}from"./vendor.931d8f24.js";import{u as h}from"./useList.da577dd6.js";import{u as x}from"./useVisible.7f795f63.js";import{L as E}from"./index.54d80d25.js";import{r as k}from"./index.d0ed3dc5.js";import{m as b,a as f}from"./index.6547ff7d.js";const C=[{label:"通用",value:1},{label:"环境专属",value:2}],I=e=>{const{params:t={},onCancel:a,onOk:r}=e,{title:n,type:l,record:o}=t,u=i.useMemo((()=>d.createAsyncFormActions()),[]),y=i.useMemo((()=>"add"===l?{type:1,onOff:!1}:o),[o]),h={taskName:{required:!0,type:"string",title:"任务名"},quartz:{required:!0,type:"string",title:"时间表达式",description:"cron格式"},type:{required:!0,type:"string",title:"类型",enum:C},onOff:{required:!0,type:"boolean",title:"开关","x-props":{checkedChildren:"开",unCheckedChildren:"关"}},job:{required:!0,type:"textarea",title:"job"},metric:{required:!0,type:"textarea",title:"metric"},description:{type:"textarea",title:"描述"}};return i.createElement(c,{visible:!0,centered:!0,title:n,onCancel:a,footer:i.createElement(i.Fragment,null,"detail"===l?i.createElement(s,{type:"primary",onClick:a},"确定"):i.createElement(i.Fragment,null,i.createElement(s,{onClick:a},"取消"),i.createElement(s,{type:"primary",onClick:()=>u.submit()},"确定")))},i.createElement(p,{labelCol:6,wrapperCol:16,actions:u,onSubmit:e=>k.post("/dev-ops/monitor/editTask",e).then((e=>{m.success(`${n}成功`),r()})),previewPlaceholder:"暂无数据",editable:"detail"!==l,initialValues:y,schema:{type:"object",properties:f(h)}}))},{Header:q,Content:v}=E,g=e=>{const{history:t,match:{path:a}}=e,r=x(),n=h("/dev-ops/monitor/taskList");i.useEffect((()=>{n.onSearch()}),[]);const d=(e=>{const{handlePlan:t,handleEdit:a,handleDetail:r}=e;return[{title:"任务名",dataIndex:"taskName"},{title:"时间表达式",dataIndex:"quartz"},{title:"任务描述",dataIndex:"description"},{title:"任务类型",dataIndex:"type",render:e=>b(e,C)},{title:"job",dataIndex:"job"},{title:"metric",dataIndex:"metric"},{title:"开关",dataIndex:"onOff",render:e=>e?"开":"关"},{title:"操作",dataIndex:"id",render:(e,n)=>i.createElement(o,null,i.createElement("a",{onClick:()=>t(n)},"计划列表"),i.createElement("a",{onClick:()=>a(n)},"编辑"),i.createElement("a",{onClick:()=>r(n)},"详情"))}]})({handlePlan:({id:e})=>{t.push(`${a}/plan-list/${e}`)},handleEdit:e=>{r.open({title:"编辑任务",type:"edit",record:e})},handleDetail:e=>{r.open({title:"任务详情",type:"detail",record:e})}});return i.createElement(E,{loading:n.loading},i.createElement(q,{title:"任务列表",extra:i.createElement(s,{type:"primary",onClick:()=>{r.open({title:"新增任务",type:"add"})}},"新增任务")}),i.createElement(v,null,i.createElement(u,l(l({columns:d},n.table),{scroll:{x:"max-content"}}))),r.visible&&i.createElement(I,{params:r.params,onCancel:r.close,onOk:()=>{r.close(),n.onRefresh()}}))},j=[{label:"大于等于",value:"checkNumMoreOrEquals"}],O=e=>{const{params:t={},onCancel:a,onOk:r}=e,{title:n,type:l,record:o}=t,u=i.useMemo((()=>d.createAsyncFormActions()),[]),y={name:{required:!0,type:"string",title:"名称"},promql:{required:!0,type:"textarea",title:"查询语句"},preId:{required:!0,type:"string",title:"上级任务ID"},onOff:{required:!0,type:"boolean",title:"开关","x-props":{checkedChildren:"开",unCheckedChildren:"关"}},checkMethod:{required:!0,type:"textarea",title:"处理结果方法",enum:j},alarmGroupList:{required:!0,type:"string",title:"报警分组ID"},context:{required:!0,type:"textarea",title:"报警推送消息"},recoverContext:{required:!0,type:"textarea",title:"服务恢复推送消息"},exceptionNum:{required:!0,type:"number",title:"计算规则"},description:{type:"textarea",title:"计划描述"}};return i.createElement(c,{visible:!0,centered:!0,title:n,onCancel:a,footer:i.createElement(i.Fragment,null,"detail"===l?i.createElement(s,{type:"primary",onClick:a},"确定"):i.createElement(i.Fragment,null,i.createElement(s,{onClick:a},"取消"),i.createElement(s,{type:"primary",onClick:()=>u.submit()},"确定")))},i.createElement(p,{labelCol:8,wrapperCol:16,actions:u,initialValues:o,onSubmit:e=>k.post("/dev-ops/monitor/editPlan",e).then((e=>{m.success(`${n}成功`),r()})),previewPlaceholder:"暂无数据",editable:"detail"!==l,schema:{type:"object",properties:f(y)}}))};const{Header:w,Content:D}=E,P=e=>{const{history:t,match:{params:{taskId:a}}}=e,r=x(),n=h("/dev-ops/monitor/planList",{},{taskId:a});i.useEffect((()=>{n.onSearch()}),[]);const d=(e=>{const{handleEdit:t,handleDetail:a}=e;return[{title:"id",dataIndex:"id"},{title:"名称",dataIndex:"name"},{title:"描述",dataIndex:"description"},{title:"查询语句",dataIndex:"promql",width:120},{title:"上级任务ID",dataIndex:"preId"},{title:"开关",dataIndex:"onOff",render:e=>e?"开":"关"},{title:"处理结果方法",dataIndex:"checkMethod",render:e=>b(e,j)},{title:"报警分组ID",dataIndex:"alarmGroupList"},{title:"报警推送消息",dataIndex:"context",width:180},{title:"服务恢复推送消息",dataIndex:"recoverContext",width:180},{title:"计算规则",dataIndex:"exceptionNum"},{title:"操作",dataIndex:"id",render:(e,r)=>i.createElement(o,null,i.createElement("a",{onClick:()=>t(r)},"编辑"),i.createElement("a",{onClick:()=>a(r)},"详情"))}]})({handleEdit:e=>{r.open({title:"编辑计划",type:"edit",record:l(l({},e),{taskId:a})})},handleDetail:e=>{r.open({title:"计划详情",type:"detail",record:l(l({},e),{taskId:a})})}});return i.createElement(E,{loading:n.loading},i.createElement("a",{className:"back h32 lh32 pl8",onClick:()=>t.goBack()},"返回"),i.createElement(w,{title:"计划列表",extra:i.createElement(s,{type:"primary",onClick:()=>{r.open({title:"新增计划",type:"add",record:{taskId:a}})}},"新增计划")}),i.createElement(D,{wrapperClassName:"plan-list"},i.createElement(u,l(l({columns:d},n.table),{scroll:{x:"max-content"}}))),r.visible&&i.createElement(O,{params:r.params,onCancel:r.close,onOk:()=>{r.close(),n.onRefresh()}}))};export default e=>{const{path:t}=e.match||{};return i.createElement(i.Fragment,null,i.createElement(y,{exact:!0,path:t,component:g}),i.createElement(y,{exact:!0,path:`${t}/plan-list/:taskId`,component:P}))};
