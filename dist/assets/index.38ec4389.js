var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,r=Object.prototype.propertyIsEnumerable,s=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r;import{_ as n,ae as c,af as l,ag as o,e as i,ah as m,b as d,ai as p,T as u}from"./vendor.931d8f24.js";import{L as h,O as f}from"./index.54d80d25.js";import{r as v}from"./index.d0ed3dc5.js";import{_ as g}from"./index.f4c393b6.js";import{u as E}from"./useVisible.7f795f63.js";import{M as b}from"./index.0d0bb693.js";import{u as y}from"./index.6547ff7d.js";const k=[{label:"上传前端资源",value:1},{label:"历史前端资源",value:2}];var _=e=>{const{logRef:p}=e,u=E(),[h,f]=n.useState([]),[y,k]=n.useState([]),_={name:"file",showUploadList:!1,action:"/dev-ops/devops/resource/upload",onChange:({file:e,fileList:t})=>{const{status:a,response:r={},name:s,size:n}=e;if("done"===a&&r.success){const e={label:r.data,value:t.length};k(y.concat([e]))}("error"===a||"done"===a&&!r.success)&&d.error("资源包上传错误")}},N=n.useMemo((()=>y.length===h.length),[y,h]);return n.createElement("div",{className:"resource-upload"},n.createElement("div",{className:"resource-upload__header"},n.createElement(c,null,n.createElement(l,((e,n)=>{for(var c in n||(n={}))t.call(n,c)&&s(e,c,n[c]);if(a)for(var c of a(n))r.call(n,c)&&s(e,c,n[c]);return e})({},_),n.createElement(o,{type:"primary"},"上传资源包")),n.createElement(o,{type:"primary",onClick:u.open,disabled:0===h.length},"同步"))),n.createElement("div",{className:"resource-upload__content package"},n.createElement("div",{className:"package__header"},"资源包列表"),n.createElement("div",{className:i("package__content",{hidden:0===y.length})},n.createElement("div",{className:"check-all"},n.createElement(m,{checked:N,onChange:e=>{e.target.checked?f(y.map((e=>e.value))):f([])}},"全选")),n.createElement("div",{className:"check-list"},n.createElement(m.Group,{value:h,options:y,onChange:e=>{f(e)}})))),u.visible&&n.createElement(b,{onOk:e=>{const t=h.map((e=>y.find((t=>t.value===e)).label)),a=p.current.batchAddLogs(t.map((t=>({title:`资源地址：${t}`,record:e.map((e=>({title:`同步 ip：${e}`,status:"pending"})))}))));return Promise.all(t.map(((t,r)=>{const s=a[r];return v.post("/dev-ops/devops/dog/sync",g({type:"resource",filePath:t,ips:e.join(",")})).then((e=>{s.record.forEach((e=>e.status="success"))})).catch((e=>{s.record.forEach((t=>{t.title=e.msg,t.status="error"}))}))}))).then((()=>{d.success("同步成功"),u.close()})).finally((()=>{p.current.batchUpdateLogs(a)}))},onCancel:u.close}))},N=e=>{const{logRef:t}=e,a=E(),[r,s]=n.useState(0),[l,i]=n.useState([]),[m,u]=n.useState([]),h=(e="")=>v.get("/dev-ops/devops/file/list",{type:3,path:e}).then((t=>{const{success:a,data:r=[]}=t;return a?r.map((t=>({key:`${e}/${t.name}`,title:t.name,isLeaf:1===t.type}))):[]})).finally((()=>{s(r-1)}));return n.useEffect((()=>{h().then((e=>{i(e)}))}),[]),n.createElement("div",{className:"resource-history"},n.createElement("div",{className:"resource-history__header"},n.createElement(c,null,n.createElement(o,{type:"primary",disabled:0===m.length,onClick:a.open},"同步"),n.createElement(o,{type:"primary",disabled:0===m.length,onClick:()=>{u([])}},"清空选中资源"))),n.createElement("div",{className:"resource-history__content"},l.length>0&&n.createElement(p,{showIcon:!0,showLine:!0,checkable:!0,treeData:l,onCheck:e=>{u(e)},loadData:async e=>{const{key:t,title:a,isLeaf:r}=e.props.data;return new Promise((e=>{r&&e(),h(t).then((a=>{i((e=>y(e,t,a))),e()}))}))},checkedKeys:m}),a.visible&&n.createElement(b,{onCancel:a.close,onOk:e=>{const r=t.current.batchAddLogs(m.map((t=>({title:`资源地址：${t}`,record:e.map((e=>({title:`同步 ip：${e}`,status:"pending"})))}))));return Promise.all(m.map(((t,a)=>{const s=r[a];return v.post("/dev-ops/devops/dog/sync",g({type:"resource",filePath:t,ips:e.join(",")})).then((e=>{s.record.forEach((e=>e.status="success"))})).catch((e=>{s.record.forEach((t=>{t.title=e.msg,t.status="error"}))}))}))).then((()=>{d.success("同步成功"),a.close()})).finally((()=>{t.current.batchUpdateLogs(r)}))}})))};const{Header:j,Content:C}=h,{TabPane:L}=u;export default()=>{const e=n.useRef(),[t,a]=n.useState(k[0].value.toString());return n.createElement(h,null,n.createElement(j,{title:"前端资源管理"}),n.createElement(C,{wrapperClassName:"fe-manage"},n.createElement("div",{className:"fe-manage__header"},n.createElement(u,{activeKey:t,onChange:e=>{a(e)}},k.map((e=>n.createElement(L,{tab:e.label,key:e.value}))))),n.createElement("div",{className:"fe-manage__content"},n.createElement("div",{className:"manage-pane"},Number(t)===k[0].value&&n.createElement(_,{logRef:e}),Number(t)===k[1].value&&n.createElement(N,{logRef:e})),n.createElement("div",{className:"log-pane"},n.createElement(f,{ref:e})))))};
