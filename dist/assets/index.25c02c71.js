var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,r=Object.getOwnPropertySymbols,n=Object.prototype.propertyIsEnumerable,a=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,s=(e,s)=>{for(var o in s||(s={}))t.call(s,o)&&a(e,o,s[o]);if(r)for(var o of r(s))n.call(s,o)&&a(e,o,s[o]);return e};import{_ as o,l,ak as d,h as i,b as c,ag as m,k as p}from"./vendor.931d8f24.js";import{u}from"./useList.da577dd6.js";import{u as f}from"./useVisible.7f795f63.js";import{L as b}from"./index.54d80d25.js";import{S as x}from"./index.cd79d446.js";import{r as h}from"./index.d0ed3dc5.js";import{m as v,f as y,a as E}from"./index.6547ff7d.js";import{T as g,E as j}from"./constant.79d8e8f2.js";var S=e=>o.createElement("div",{className:"actions"},e.children);var q=e=>{const{onOk:t,onCancel:r}=e,[n,a]=o.useState([]),s=o.useMemo((()=>l.createAsyncFormActions()),[]);o.useEffect((()=>{h.get("/dev-ops/devops/db/dbList").then((e=>{a(e)}))}),[]);const m=(e=>({dbName:{required:!0,type:"string",title:"数据库",enum:e},type:{required:!0,type:"string",title:"任务类型",enum:g},sql:{required:!0,type:"textarea",title:"SQL","x-props":{rows:4,placeholder:"请输入SQL"}},reason:{required:!0,type:"textarea",title:"原因","x-props":{rows:4,placeholder:"请输入原因"}}}))(n);return o.createElement(d,{visible:!0,centered:!0,title:"添加",onOk:()=>s.submit().then((({values:e})=>h.post("/dev-ops/devops/db/submitSql",e).then((()=>{c.success("添加成功"),t()})))),onCancel:r},o.createElement(i,{labelCol:6,validateFirst:!0,wrapperCol:16,actions:s,schema:{type:"object",properties:E(m)}}))};const{Header:O,Content:k}=b;export default()=>{const e=f(),t=u("/dev-ops/devops/db/sqlList",{},{needSelectType:!1});o.useEffect((()=>{t.onSearch()}),[]);const r={type:{type:"string",title:"类型",enum:g},status:{type:"string",title:"状态",enum:j}},n=(e=>{const{handleDelete:t,handleExecute:r}=e;return[{title:"userName",dataIndex:"userName"},{title:"sql",dataIndex:"sql"},{title:"数据库名",dataIndex:"dbName"},{title:"任务类型",dataIndex:"type",render:e=>v(e,g)},{title:"状态",dataIndex:"status",render:e=>v(e,j)},{title:"执行时间",dataIndex:"gmtExecute",render:e=>y(e,"YYYY-MM-DD HH:mm:ss","暂无")},{title:"原因",dataIndex:"reason"},{title:"操作",dataIndex:"operation",render:(e,n)=>{if(0===n.status)return o.createElement(o.Fragment,null,o.createElement("a",{onClick:()=>t(n)},"删除"),o.createElement("a",{onClick:()=>r(n),style:{marginLeft:4}},"执行"))}}]})({handleDelete:e=>{d.confirm({centered:!0,title:"确认删除吗?",content:"删除后不可恢复",onOk:()=>h.post("/dev-ops/devops/db/delSql",{id:e.id}).then((e=>{c.success("删除成功"),t.onRefresh()}))})},handleExecute:({id:e})=>{d.confirm({centered:!0,title:"确认执行吗？",content:"是否确认执行改SQL？",onOk:()=>{window.location.href=`/dev-ops/devops/db/executeSql?id=${e}`,c.success("执行成功"),t.onRefresh()}})}});return o.createElement(b,{loading:t.loading},o.createElement(O,{title:"订正|导出|表结构"}),o.createElement(k,null,o.createElement(x,{schema:r,onSearch:t.onSearch}),o.createElement(S,null,o.createElement(m,{type:"primary",onClick:()=>{e.open()}},"添加")),o.createElement(p,s(s({columns:n},t.table),{scroll:{x:"max-content"}})),e.visible&&o.createElement(q,{params:e.params,onCancel:e.close,onOk:()=>{e.close(),t.onRefresh()}})))};
